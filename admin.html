<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget V67</title>
    <style>
        :root { --c-bg: #fff; --c-txt: #333; }
        body { margin: 0; font-family: sans-serif; padding: 1rem; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 10px; }
        .widget-block {
            box-sizing: border-box;
            padding: 15px;
            /* Viewer uses clean borders */
            border: 1px solid transparent; 
            border-radius: 8px;
            overflow: hidden;
            display: flex; flex-direction: column; justify-content: center;
        }
        /* THEMES */
        .theme-card .widget-block { border: 1px solid #eee; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .theme-minimal .widget-block { border: none; background: transparent; }
        
        .txt-lg { font-size: 1.5em; font-weight: 700; }
        .txt-sm { opacity: 0.7; font-size: 0.8em; }
        
        /* BUBBLE STYLE FOR COUNTDOWN */
        .countdown-bubble { 
            /* Accent Color Applied Here */
            padding: 5px 10px; border-radius: 8px; 
            display: flex; justify-content: space-between; 
            font-size: 1.1em; font-weight: bold;
            height: 100%; align-items: center;
        }
    </style>
</head>
<body>
    <div id="edit-btn" style="position:fixed;top:10px;right:10px;display:none;background:#fff;padding:5px;border-radius:50%;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,0.2);">âœŽ</div>
    <div id="root" style="display:contents"></div>
    <script>
        function decode(str) { try { return JSON.parse(decodeURIComponent(escape(window.atob(str)))); } catch(e) { return null; } }
        
        function render() {
            const hash = window.location.hash.substring(1);
            if(!hash) return;
            const data = decode(hash);
            if(!data) return;
            
            // Show edit pencil if not in preview mode
            const params = new URLSearchParams(window.location.search);
            if(params.get('preview') !== 'true') {
                const btn = document.getElementById('edit-btn');
                btn.style.display = 'block';
                btn.onclick = () => {
                     let url = window.location.href.split('#')[0].replace('index.html','admin.html');
                     window.location.href = url + window.location.hash;
                };
            }
            
            const root = document.getElementById('root');
            root.innerHTML = '';
            
            if(data.settings.theme === 'card') document.body.classList.add('theme-card');
            
            data.blocks.forEach(b => {
                const div = document.createElement('div');
                div.className = 'widget-block';
                div.style.width = `calc(${b.width}% - 10px)`;
                div.style.height = `${b.height}px`;
                
                // BUBBLE STYLE
                let bg = 'transparent'; let col = 'inherit';
                if(b.color && b.color !== 'default') { bg = b.color; col = '#fff'; }
                if(b.textColor && b.textColor !== 'default') col = b.textColor;
                
                // Exceptions
                if(b.type === 'empty') return; // Truly empty space
                
                div.style.background = bg;
                div.style.color = col;
                
                // RENDER CONTENT (Simplified for V67 Viewer - Full logic needs V59 restoration if requested)
                if(b.type === 'header') div.innerHTML = `<div class="txt-lg">${b.text}</div>`;
                else if(b.type === 'countdown') {
                     div.innerHTML = `<div class="countdown-bubble" style="color:${col}"><span>${b.label}</span><span>--</span></div>`;
                }
                else div.innerHTML = `<div class="txt-sm" style="text-transform:uppercase">${b.type.replace('_',' ')}</div><div class="txt-lg">${b.label||''}</div>`;
                
                root.appendChild(div);
            });
        }
        window.addEventListener('hashchange', render);
        render();
    </script>
</body>
</html>
